<form (ngSubmit)="onSubmitForm()" [formGroup]="mainForm" class="main-form">
  <mat-card>
    <mat-card-title>Inscription</mat-card-title>

    <mat-card class="form-card" formGroupName="personalInfo">
      <mat-card-subtitle>Informations personnelles</mat-card-subtitle>

      <div class="form-row">
        <mat-form-field appearance="fill">
          <mat-label>Prénom</mat-label>
          <input formControlName="firstName" matInput type="text" />
          <mat-error>Ce champ est requis</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Nom</mat-label>
          <input formControlName="lastName" matInput type="text" />
          <mat-error>Ce champ est requis</mat-error>
        </mat-form-field>
      </div>
    </mat-card>

    <mat-card class="form-card">
      <mat-card-subtitle>Comment préférez-vous que l'on vous contacte ?</mat-card-subtitle>

      <mat-radio-group [formControl]="contactPreferenceCtrl">
        <mat-radio-button value="email">Mail</mat-radio-button>
        <mat-radio-button value="phone">Téléphone</mat-radio-button>
      </mat-radio-group>
    </mat-card>

    @if (showEmail()) {
      <mat-card [formGroup]="emailForm" class="form-card">
        <mat-card-subtitle>Email</mat-card-subtitle>

        <div class="form-row">
          <mat-form-field appearance="fill">
            <mat-label>Adresse mail</mat-label>
            <input formControlName="email" matInput type="text" />
            <mat-error>{{ getFormControlErrorText(emailCtrl) }}</mat-error>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Confirmer votre adresse mail</mat-label>
            <input formControlName="confirm" matInput type="text" />
            <mat-error>{{ getFormControlErrorText(confirmEmailCtrl) }}</mat-error>
          </mat-form-field>
        </div>

        @if (showEmailError()) {
          <small class="error-text">Les deux adresses ne correspondent pas</small>
        }
      </mat-card>
    }

    @if (showPhone()) {
      <mat-card class="form-card">
        <mat-card-subtitle>Téléphone</mat-card-subtitle>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Numéro de téléphone</mat-label>
          <input [formControl]="phoneCtrl" matInput type="text" />
          <mat-error>{{ getFormControlErrorText(phoneCtrl) }}</mat-error>
        </mat-form-field>
      </mat-card>
    }

    <mat-card [formGroup]="loginInfoForm" class="form-card">
      <mat-card-subtitle>Informations de connexion</mat-card-subtitle>

      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Nom d'utilisateur</mat-label>
        <input formControlName="username" matInput type="text" />
        <mat-error>Ce champ est requis</mat-error>
      </mat-form-field>

      <div class="form-row">
        <mat-form-field appearance="fill">
          <mat-label>Mot de passe</mat-label>
          <input formControlName="password" matInput type="password" />
          <mat-error>Ce champ est requis</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Confirmer votre mot de passe</mat-label>
          <input formControlName="confirmPassword" matInput type="password" />
          <mat-error>Ce champ est requis</mat-error>
        </mat-form-field>
      </div>
    </mat-card>

    @if (mainForm.valid) {
      <mat-card-actions>
        <button [disabled]="isSaving()" color="primary" mat-flat-button type="submit">
          ENREGISTRER
        </button>
      </mat-card-actions>
    }

    @if (saveError()) {
      <p class="error-text">{{ saveError() }}</p>
    }

    @if (isSaving()) {
      <div class="loading">
        <mat-spinner color="primary" mode="indeterminate"></mat-spinner>
      </div>
    }

    @if (showPasswordError()) {
      <small class="error-text">Les mots de passe ne correspondent pas</small>
    }
  </mat-card>
</form>
